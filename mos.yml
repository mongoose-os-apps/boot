author: mongoose-os
description: Mongoose OS boot loader
version: 1.2.0

# Currently only STM32 is supported but platform-specific parts are isolated
# and the plan is to use it more widely.
platform: stm32

# This is a vary special "app" in that it overrides everything starting from the main function.
# Essentially, we leverage the build infrastructure provided by mos but use none of the runtime,
# carefully selecting bits we need ourselves.

sources:
  - src
  - src/${platform}

cdefs:
  JSON_MINIMAL: 1
  JSON_ENABLE_ARRAY: 0
  CS_ENABLE_STDIO: 0
  MGOS_BOOT_BUILD: 1
  MGOS_ENABLE_CORE_DUMP: 0
  APP0_OFFSET: 65536

conds:
  - when: mos.platform == "stm32"
    apply:
      build_vars:
        MGOS_BL_BIN: ""
        LD_SCRIPT: ld/mgos_boot_stm32.ld
        STM32_LIBC: -lc_nano

libs:
  - origin: https://github.com/mongoose-os-libs/bootloader
  - origin: https://github.com/mongoose-os-libs/vfs-dev-encr
  - origin: https://github.com/mongoose-os-libs/vfs-dev-part
  - origin: https://github.com/mongoose-os-libs/vfs-dev-ram
  - origin: https://github.com/mongoose-os-libs/vfs-dev-spi-flash

manifest_version: 2018-06-20
